
load ptcloud.mat;

    ring = readField(ptcloud,'laser_id')+1; %获取激光点云的环号
    azimuth = single(readField(ptcloud,'horizon_angle'))/100; %获取激光点云的方位角0.00~360.00
    
    xyz = readXYZ(ptcloud); 
   
    xyzard = [xyz,azimuth,single(ring),sqrt(xyz(:,1).^2 + xyz(:,2).^2 + xyz(:,3).^2)]; 
    
% new = sortrows(xyzard,6);
% new(:, 7) = 10;
% i = 1;
% while(i< 58319)
%     while((new{i+1, 6}-new{i, 6})>0.5)
%         new{i, 8} = 0;
%     end
%     i = i + 1;
% end

new = sortrows(xyzard,[5,6,1,2,3]);
new(new(:,6)<5,:) = [];
new(new(:,6)>28,:) = [];
new(new(:,3)>-1,:) = [];
% a3 = new(:,5);
% a4 = new(:,5);
% a3 = a3';
% a4 = a4';
% a3(11665:11665) = [];
% a4(1:1) = [];
% a3 = a3';
% a4 = a4';
% b1 = a4-a3;
% b1(:,2)=1;
% 
% b1(b1(:,1)>0,2)=0;
% b1 = b1';
% b1(:,11665) = 1;
% b1 = b1';
% new(:, 8) = b1(:,2);
% new(new(:,8)>0,:) = [];

% a1 = new(:,6);
% a2 = new(:,6);
% a1 = a1';
% a2 = a2';
% a1(15603:15603) = [];
% a2(1:1) = [];
% a1 = a1';
% a2 = a2';
% b = a2-a1;
% b(:,2)=1;
% b(b(:,1)>0.01,2)=0;
% b = b';
% b(:,15603) = 1;
% b = b';
% new(:, 8) = b(:,2);
% new(new(:,8)<1,:) = [];
% 
% a1 = new(:,6);
% a2 = new(:,6);
% a1 = a1';
% a2 = a2';
% a1(13366:13366) = [];
% a2(1:1) = [];
% a1 = a1';
% a2 = a2';
% b = a2-a1;
% b(:,2)=1;
% b(b(:,1)>0.01,2)=0;
% b = b';
% b(:,13366) = 1;
% b = b';
% new(:, 8) = b(:,2);
% new(new(:,8)<1,:) = [];
% 
% a1 = new(:,6);
% a2 = new(:,6);
% a1 = a1';
% a2 = a2';
% a1(12406:12406) = [];
% a1(12405:12405) = [];
% a1(12404:12404) = [];
% a1(12403:12403) = [];
% a2(1:1) = [];
% a2(2:2) = [];
% a2(3:3) = [];
% a2(4:4) = [];
% a1 = a1';
% a2 = a2';
% b = a2-a1;
% b(:,2)=1;
% b(b(:,1)>0.01,2)=0;
% b = b';
% b(:,12403) = 1;
% b(:,12404) = 1;
% b(:,12405) = 1;
% b(:,12406) = 1;
% b = b';
% new(:, 8) = b(:,2);
% new(new(:,8)<1,:) = [];

a1 = new(:,3);
a2 = new(:,3);
a1 = a1';
a2 = a2';
a1(15603:15603) = [];
a2(1:1) = [];
a1 = a1';
a2 = a2';
b = a2-a1;
b(:,2)=1;
b(b(:,1)>0.001,2)=0;
b(b(:,1)<-0.001,2)=0;
b = b';
b(:,15603) = 1;
b = b';
new(:, 8) = b(:,2);
new(new(:,8)<1,:) = [];

a1 = new(:,2);
a2 = new(:,2);
a1 = a1';
a2 = a2';
a1(12108:12108) = [];
a2(1:1) = [];
a1 = a1';
a2 = a2';
b = a2-a1;
b(:,2)=1;
b(b(:,1)>1,2)=0;
b(b(:,1)<-1,2)=0;
b = b';
b(:,12108) = 1;
b = b';
new(:, 8) = b(:,2);
new(new(:,8)<1,:) = [];

a1 = new(:,1);
a2 = new(:,1);
a1 = a1';
a2 = a2';
a1(8183:8183) = [];
a2(1:1) = [];
a1 = a1';
a2 = a2';
b = a2-a1;
b(:,2)=1;
b(b(:,1)>0.009,2)=0;
b(b(:,1)<-0.009,2)=0;
b = b';
b(:,8183) = 1;
b = b';
new(:, 8) = b(:,2);
new(new(:,8)<1,:) = [];

a1 = new(:,6);
a2 = new(:,6);
a1 = a1';
a2 = a2';
a1(989:989) = [];
a2(1:1) = [];
a1 = a1';
a2 = a2';
b = a2-a1;
b(:,2)=1;
b(b(:,1)>0.001,2)=0;
b = b';
b(:,989) = 1;
b = b';
new(:, 8) = b(:,2);
new(new(:,8)<1,:) = [];

plot3(new(:,1),new(:,2),new(:,3),'r.');
view(0,90)%

